"use strict";(self.webpackChunklibrary=self.webpackChunklibrary||[]).push([[378],{6378:(C,v,l)=>{l.r(v),l.d(v,{DashboardModule:()=>pt});var h=l(9808),_=l(2382),p=l(520),x=l(262),k=l(2843),t=l(1223),u=l(7556);let T=(()=>{class i{constructor(e){this.authService=e}intercept(e,o){const n="BearerIntercept "+localStorage.getItem("token");return console.log("HttpInterceptor: "+n),console.log("HttpInterceptor: "),n&&(e=e.clone({headers:e.headers.set("authorization",n.replace('"',"").substr(0,n.length-2))})),o.handle(e).pipe((0,x.K)(r=>(0,k._)(r)))}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(u.e))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac}),i})();var c=l(3902),a=l(5935),f=l(2468),S=l(639),I=l(4917);class m{constructor(){this._id="",this.userId="",this.bookId="",this.timeStamp="",this.returnDate=""}}var Z=l(4872),q=l(1135),F=l(7579);let U=(()=>{class i{constructor(e,o){this.http=e,this.dataService=o,this.borrowed=[],this.borrowedSubject=new q.X([]),this.responseEmitter=new F.x,this.init()}init(){this.dataService.getBorrowed().subscribe(e=>{this.borrowed=e,this.borrowedSubject.next([...this.borrowed])})}getBorrowed(){return this.borrowedSubject}addBorrowed(e){this.dataService.addBorrowed(e).subscribe(o=>{console.log(o),this.responseEmitter.next(o.message.toString()),e._id=o.insertedId.toString(),this.borrowed.push(e),this.borrowedSubject.next(this.borrowed)})}deleteBorrowed(e){this.dataService.deleteBorrowed(e).subscribe(o=>{console.log(o),this.borrowed=this.borrowed.filter(n=>n._id!=e),this.borrowedSubject.next(this.borrowed)})}editBorrowed(e){this.dataService.editBorrowed(e).subscribe(o=>{console.log(o),this.borrowed[this.borrowed.findIndex(n=>n._id==e._id)]=e,this.borrowedSubject.next(this.borrowed)},o=>{console.log(o)})}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(p.eN),t.LFG(f.D))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var D=l(4961);let j=(()=>{class i{transform(e,o){return e&&""!=o?e.filter(n=>n.name.toLowerCase().includes(o.toLowerCase())):e}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275pipe=t.Yjl({name:"nameFilter",type:i,pure:!1}),i})();function M(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).startLending()}),t._uU(1,"LEND BOOK"),t.qZA()}}function E(i,s){if(1&i&&(t.TgZ(0,"div",6)(1,"h4",10),t._uU(2),t.qZA()()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngClass",e.errorMessage.includes("unsuccessful")?"text-danger":"text-success"),t.xp6(1),t.Oqu(e.errorMessage)}}function O(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"tr",17),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(4).showDetail(r)}),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA()()}if(2&i){const e=s.$implicit;t.xp6(2),t.Oqu(e._id),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.email)}}function B(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",0)(1,"div",1)(2,"h5"),t._uU(3,"Selected user:"),t.qZA(),t.TgZ(4,"h5",2),t._uU(5),t.qZA(),t.TgZ(6,"h5",3),t._uU(7),t.qZA(),t.TgZ(8,"h5",4),t._uU(9),t.qZA(),t.TgZ(10,"h5",4),t._uU(11),t.qZA(),t.TgZ(12,"h5",4),t._uU(13),t.qZA()(),t.TgZ(14,"div",18)(15,"button",19),t.NdJ("click",function(){return t.CHM(e),t.oxw(4).onSubmit()}),t._uU(16,"LEND BOOK"),t.qZA(),t.TgZ(17,"button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw(4).onCancel()}),t._uU(18,"Cancel"),t.qZA()()()}if(2&i){const e=t.oxw(4);t.xp6(5),t.Oqu(e.selectedUser.name),t.xp6(2),t.hij("Id: ",e.selectedUser._id,""),t.xp6(2),t.hij("E-mail: ",e.selectedUser.email,""),t.xp6(2),t.hij("Address: ",e.selectedUser.address,""),t.xp6(2),t.hij("Total late fee: ",e.calculateLateFee(e.posudbeKorisnika),"\u20ac"),t.xp6(2),t.Q6J("disabled",e.canBorrow)}}function N(i,s){if(1&i&&(t.TgZ(0,"div")(1,"table",13)(2,"thead")(3,"tr")(4,"th",14),t._uU(5,"Id"),t.qZA(),t.TgZ(6,"th",14),t._uU(7,"Name"),t.qZA(),t.TgZ(8,"th",14),t._uU(9,"E-mail"),t.qZA()()(),t.TgZ(10,"tbody"),t.YNc(11,O,7,3,"tr",15),t.ALo(12,"nameFilter"),t.qZA()(),t.YNc(13,B,19,6,"div",16),t._UZ(14,"div"),t.qZA()),2&i){const e=t.oxw(3);t.xp6(11),t.Q6J("ngForOf",t.xi3(12,2,e.users,e.query)),t.xp6(2),t.Q6J("ngIf",e.selectedUser.name)}}function L(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"div")(2,"h1"),t._uU(3,"Select User"),t.qZA()(),t.TgZ(4,"div",6)(5,"div",11)(6,"p"),t._uU(7,"Search by name:"),t.qZA(),t.TgZ(8,"input",12),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw(2).query=n}),t.qZA()()(),t.YNc(9,N,15,5,"div",5),t.qZA()}if(2&i){const e=t.oxw(2);t.xp6(8),t.Q6J("ngModel",e.query),t.xp6(1),t.Q6J("ngIf",e.users)}}function J(i,s){if(1&i&&(t.TgZ(0,"div")(1,"div",6),t.YNc(2,M,2,0,"button",7),t.qZA(),t.YNc(3,E,3,2,"div",8),t.YNc(4,L,10,2,"div",5),t.qZA()),2&i){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",!e.userDisplay),t.xp6(1),t.Q6J("ngIf",2==e.authorizationLevel),t.xp6(1),t.Q6J("ngIf",e.userDisplay)}}let R=(()=>{class i{constructor(e,o){this.borrowedService=e,this.userService=o,this.selectedBook=new a.f,this.authorizationLevel=0,this.cancelEvent=new t.vpe,this.userDisplay=!1,this.users=[],this.userSubject=null,this.subscription=null,this.selectedUser=new Z.n,this.query="",this.canBorrow=!1,this.posudbeKorisnika=[],this.posudbeKorisnikaSubject=null,this.subscription7=null,this.errorMessage=""}ngOnInit(){this.userSubject=this.userService.getUsers(),this.subscription=this.userSubject.subscribe(e=>{console.log(e),this.users=e},e=>{console.log(e)}),this.borrowedService.responseEmitter.subscribe(e=>{this.errorMessage=e,setTimeout(()=>{this.errorMessage=""},2500)})}onCancel(){this.query="",this.selectedUser=new Z.n,this.userDisplay=!1,this.cancelEvent.emit()}startLending(){this.userSubject=this.userService.getUsers(),this.subscription=this.userSubject.subscribe(e=>{console.log(e),this.users=e},e=>{console.log(e)}),this.userDisplay=!0}calculateLateFee(e){let o=0,n=new Date;for(let r=0;r<e.length;r++){let d=new Date(e[r].returnDate);if(d<n){let b=n.getTime()-d.getTime();o+=.1*Math.ceil(b/864e5)}}return o.toPrecision(2)}boolLateFee(e){return parseFloat(this.calculateLateFee(e))>parseFloat("0")}showDetail(e){this.selectedUser=Object.assign({},e),this.posudbeKorisnikaSubject=this.borrowedService.getBorrowed(),this.subscription7=this.posudbeKorisnikaSubject.subscribe(o=>{console.log(o),this.posudbeKorisnika=o.filter(n=>n.userId==this.selectedUser._id)},o=>{console.log(o)}),this.canBorrow=this.boolLateFee(this.posudbeKorisnika)}onSubmit(){let e=new m;e.userId=this.selectedUser._id,e.bookId=this.selectedBook._id;let o=new Date;e.timeStamp=o.toLocaleString(),e.returnDate=new Date(o.setMonth(o.getMonth()+1)).toLocaleString(),this.borrowedService.addBorrowed(e),this.query="",this.selectedUser=new Z.n,this.userDisplay=!1,this.cancelEvent.emit()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(U),t.Y36(D.f))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-dashboard-detail"]],inputs:{selectedBook:"selectedBook",authorizationLevel:"authorizationLevel"},outputs:{cancelEvent:"cancelEvent"},decls:13,vars:6,consts:[[1,"container","d-flex","justify-content-center",2,"padding","10px"],[1,"card",2,"padding","10px","margin","0px auto","width","70%"],[1,"card-title"],[1,"card-subtitle","text-muted"],[1,"card-text"],[4,"ngIf"],[1,"container","d-flex","justify-content-center"],["class","btn btn-warning btn-lg",3,"click",4,"ngIf"],["class","container d-flex justify-content-center",4,"ngIf"],[1,"btn","btn-warning","btn-lg",3,"click"],[3,"ngClass"],[2,"width","45%"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],[1,"table","table-striped"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],["class","container d-flex justify-content-center","style","padding: 10px;",4,"ngIf"],[3,"click"],[1,"container","d-flex","justify-content-around","align-items-center"],[1,"btn","btn-warning","btn-lg",3,"disabled","click"],[1,"btn","btn-outline-danger","btn-lg",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),t._uU(3),t.qZA(),t.TgZ(4,"h2",3),t._uU(5),t.qZA(),t.TgZ(6,"h5",4),t._uU(7),t.qZA(),t.TgZ(8,"h5",4),t._uU(9),t.qZA(),t.TgZ(10,"h5",4),t._uU(11),t.qZA()()(),t.YNc(12,J,5,3,"div",5)),2&e&&(t.xp6(3),t.Oqu(o.selectedBook.title),t.xp6(2),t.Oqu(o.selectedBook.authorId),t.xp6(2),t.hij("Genre: ",o.selectedBook.genreId,""),t.xp6(2),t.hij("Edition: ",o.selectedBook.edition,""),t.xp6(2),t.hij("Publisher: ",o.selectedBook.publisherId,""),t.xp6(1),t.Q6J("ngIf",2==o.authorizationLevel))},directives:[h.O5,h.mk,_.Fj,_.JJ,_.On,h.sg],pipes:[j],styles:["tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#86b7fe}"]}),i})(),Y=(()=>{class i{transform(e,o){return e&&""!=o?e.filter(n=>n.authorId.toLowerCase().includes(o.toLowerCase())):e}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275pipe=t.Yjl({name:"authorFilter",type:i,pure:!1}),i})(),P=(()=>{class i{transform(e,o){return e&&""!=o?e.filter(n=>n.title.toLowerCase().includes(o.toLowerCase())):e}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275pipe=t.Yjl({name:"titleFilter",type:i,pure:!1}),i})();function Q(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",8)(1,"h4",9),t._uU(2,"Welcome, "),t.TgZ(3,"button",10),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).profile()}),t._uU(4),t.qZA(),t._uU(5),t.qZA(),t.TgZ(6,"button",11),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).logout()}),t._uU(7,"Logout"),t.qZA()()}if(2&i){const e=t.oxw(2);t.xp6(4),t.Oqu(e.user.name),t.xp6(1),t.hij(" (",e.user.email,")")}}function K(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",12)(1,"div",13)(2,"h4",9),t._uU(3),t.qZA(),t.TgZ(4,"button",14),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).returns()}),t._uU(5,"MANAGE RETURNS"),t.qZA(),t.TgZ(6,"button",10),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).admin()}),t._uU(7,"Administrator tools"),t.qZA(),t.TgZ(8,"button",11),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).logout()}),t._uU(9,"Logout"),t.qZA()()()}if(2&i){const e=t.oxw(2);t.xp6(3),t.hij("Admin (",e.user.email,")")}}function G(i,s){1&i&&(t.TgZ(0,"div",15)(1,"h1"),t._uU(2,"Lend books"),t.qZA()())}function H(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"tr",19),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(3).showDetail(r)}),t.TgZ(1,"td",20),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA()()}if(2&i){const e=s.$implicit,o=t.oxw(3);t.xp6(2),t.Oqu(e.title),t.xp6(2),t.Oqu(e.authorId),t.xp6(2),t.Oqu(o.genreIdToName(e.genreId))}}function z(i,s){if(1&i&&(t.TgZ(0,"div")(1,"table",16)(2,"thead")(3,"tr")(4,"th",17),t._uU(5,"Title"),t.qZA(),t.TgZ(6,"th",17),t._uU(7,"Author"),t.qZA(),t.TgZ(8,"th",17),t._uU(9,"Genre"),t.qZA()()(),t.TgZ(10,"tbody"),t.YNc(11,H,7,3,"tr",18),t.ALo(12,"authorFilter"),t.ALo(13,"titleFilter"),t.qZA()()()),2&i){const e=t.oxw(2);t.xp6(11),t.Q6J("ngForOf",t.xi3(12,1,t.xi3(13,4,e.knjige,e.query),e.query2))}}function W(i,s){if(1&i&&t._UZ(0,"app-dashboard-detail",21),2&i){const e=t.oxw(2);t.Q6J("selectedBook",e.bookClick)("authorizationLevel",e.user.level)}}function X(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div"),t.YNc(1,Q,8,2,"div",1),t.YNc(2,K,10,1,"div",2),t.YNc(3,G,3,0,"div",3),t.TgZ(4,"div")(5,"h1"),t._uU(6,"Books"),t.qZA()(),t.TgZ(7,"div",4)(8,"div",5)(9,"p"),t._uU(10,"Search by title:"),t.qZA(),t.TgZ(11,"input",6),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw().query=n}),t.qZA()(),t.TgZ(12,"div",5)(13,"p"),t._uU(14,"Search by author:"),t.qZA(),t.TgZ(15,"input",6),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw().query2=n}),t.qZA()()(),t.YNc(16,z,14,7,"div",0),t.YNc(17,W,1,2,"app-dashboard-detail",7),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",1==e.user.level),t.xp6(1),t.Q6J("ngIf",e.user&&2==e.user.level),t.xp6(1),t.Q6J("ngIf",e.user&&2==e.user.level),t.xp6(8),t.Q6J("ngModel",e.query),t.xp6(4),t.Q6J("ngModel",e.query2),t.xp6(1),t.Q6J("ngIf",e.knjige),t.xp6(1),t.Q6J("ngIf",null!=e.bookClick)}}let $=(()=>{class i{constructor(e,o,n,r,d,b,g){this.http=e,this.dataService=o,this.auth=n,this.route=r,this.router=d,this.booksService=b,this.classificationService=g,this.user=null,this.knjige=[],this.bookSubject=null,this.subscription=null,this.genres=[],this.genreSubject=null,this.subscription3=null,this.publishers=[],this.publisherSubject=null,this.subscription4=null,this.new=new a.f,this.query="",this.query2="",this.bookClick=null}ngOnInit(){this.user=this.auth.getUser(),this.bookSubject=this.booksService.getBooks(),this.subscription=this.bookSubject.subscribe(e=>{console.log(e),this.knjige=e},e=>{console.log(e)}),this.genreSubject=this.classificationService.getGenres(),this.subscription3=this.genreSubject.subscribe(e=>{console.log(e),this.genres=e},e=>{console.log(e)}),this.publisherSubject=this.classificationService.getPublishers(),this.subscription4=this.publisherSubject.subscribe(e=>{console.log(e),this.publishers=e},e=>{console.log(e)})}genreIdToName(e){return this.genres.length<1&&(this.genreSubject=this.classificationService.getGenres(),this.subscription3=this.genreSubject.subscribe(n=>{console.log(n),this.genres=n},n=>{console.log(n)})),this.genres.filter(n=>n._id==e).map(n=>n.name)}publisherIdToName(e){return this.publishers.filter(n=>n._id==e).map(n=>n.name)}showDetail(e){let o=Object.assign({},e);o.publisherId=this.publisherIdToName(o.publisherId).toString(),o.genreId=this.genreIdToName(o.genreId).toString(),this.bookClick=o}profile(){this.router.navigate(["profile"])}admin(){this.router.navigate(["admin"])}returns(){this.router.navigate(["returns"])}logout(){this.auth.logout()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(p.eN),t.Y36(f.D),t.Y36(u.e),t.Y36(c.gz),t.Y36(c.F0),t.Y36(S.y),t.Y36(I.c))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-dashboard"]],decls:1,vars:1,consts:[[4,"ngIf"],["style","padding: 20px; border: 1px dashed #d4af37; background-color:  #e9ddb9; margin-top: 10px;","class","d-flex justify-content-around align-items-center",4,"ngIf"],["style","margin-top: 10px;",4,"ngIf"],["style","padding: 30px;",4,"ngIf"],[1,"d-flex","justify-content-around","align-items-center"],[2,"width","45%"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],[3,"selectedBook","authorizationLevel",4,"ngIf"],[1,"d-flex","justify-content-around","align-items-center",2,"padding","20px","border","1px dashed #d4af37","background-color","#e9ddb9","margin-top","10px"],[2,"padding","0.375rem"],[1,"btn","btn-outline-info","btn-lg",3,"click"],[1,"btn","btn-secondary",3,"click"],[2,"margin-top","10px"],[1,"d-flex","justify-content-evenly","align-items-center",2,"padding","20px","background-color","#e9ddb9"],[1,"btn","btn-danger","btn-lg",3,"click"],[2,"padding","30px"],[1,"table","table-striped"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"linkknjiga"],[3,"selectedBook","authorizationLevel"]],template:function(e,o){1&e&&t.YNc(0,X,18,7,"div",0),2&e&&t.Q6J("ngIf",o.user&&o.user.name)},directives:[h.O5,_.Fj,_.JJ,_.On,h.sg,R],pipes:[Y,P],styles:["tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#86b7fe}.linkknjiga[_ngcontent-%COMP%]{font-style:oblique;font-size:larger}"]}),i})();function V(i,s){if(1&i&&(t.TgZ(0,"div",7)(1,"div",8)(2,"h4"),t._uU(3),t.qZA(),t.TgZ(4,"h5"),t._uU(5),t.qZA(),t.TgZ(6,"div"),t._uU(7),t._UZ(8,"hr"),t._uU(9),t.qZA()()()),2&i){const e=s.$implicit,o=t.oxw(2);t.xp6(3),t.Oqu(o.bookIdToTitle(e.bookId)),t.xp6(2),t.Oqu(o.bookIdToAuthor(e.bookId)),t.xp6(2),t.hij(" Borrowed on: ",e.timeStamp.split(",")[0],""),t.xp6(2),t.hij(" Return by: ",e.returnDate.split(",")[0]," ")}}function tt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"div",1)(2,"div",2)(3,"h1"),t._uU(4),t.qZA(),t.TgZ(5,"div",3),t.YNc(6,V,10,4,"div",4),t.qZA()(),t.TgZ(7,"div",5)(8,"h5"),t._uU(9,"User data"),t.qZA(),t.TgZ(10,"h6"),t._uU(11),t.qZA(),t.TgZ(12,"h6"),t._uU(13),t.qZA(),t.TgZ(14,"h6"),t._uU(15),t.qZA(),t._UZ(16,"br"),t.TgZ(17,"h4"),t._uU(18),t.qZA(),t._UZ(19,"br"),t.TgZ(20,"button",6),t.NdJ("click",function(){return t.CHM(e),t.oxw().back()}),t._uU(21,"Back"),t.qZA()()()()}if(2&i){const e=t.oxw();t.xp6(4),t.hij("My borrowed books (",e.borrowed.length,")"),t.xp6(2),t.Q6J("ngForOf",e.borrowed),t.xp6(5),t.hij("Name: ",e.user.name,""),t.xp6(2),t.hij("E-mail: ",e.user.email,""),t.xp6(2),t.hij("Address: ",e.user.address,""),t.xp6(3),t.hij("Late fee: ",e.calculateLateFee(),"\u20ac")}}let et=(()=>{class i{constructor(e,o,n,r,d,b,g,w){this.http=e,this.dataService=o,this.auth=n,this.route=r,this.router=d,this.borrowedService=b,this.fb=g,this.bookService=w,this.user=null,this.borrowed=[],this.borrowedSubject=null,this.subscription=null,this.books=[],this.bookSubject=null,this.subscription2=null}ngOnInit(){this.user=this.auth.getUser(),this.borrowedSubject=this.borrowedService.getBorrowed(),this.subscription=this.borrowedSubject.subscribe(e=>{console.log(e),this.borrowed=e.filter(o=>{var n;return o.userId==(null===(n=this.user)||void 0===n?void 0:n._id)})},e=>{console.log(e)}),this.bookSubject=this.bookService.getBooks(),this.subscription2=this.bookSubject.subscribe(e=>{console.log(e),this.books=e},e=>{console.log(e)})}back(){this.router.navigate(["/"])}bookIdToTitle(e){return this.books.filter(n=>n._id==e).map(n=>n.title)}bookIdToAuthor(e){return this.books.filter(n=>n._id==e).map(n=>n.authorId)}calculateLateFee(){let e=0,o=new Date;for(let n=0;n<this.borrowed.length;n++){let r=new Date(this.borrowed[n].returnDate);if(r<o){let d=o.getTime()-r.getTime();e+=.1*Math.ceil(d/864e5)}}return e.toPrecision(2)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(p.eN),t.Y36(f.D),t.Y36(u.e),t.Y36(c.gz),t.Y36(c.F0),t.Y36(U),t.Y36(_.qu),t.Y36(S.y))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-profile"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"row"],[1,"col-sm-8",2,"padding-top","2rem"],[1,"card",2,"background-color","#d4af37","padding","5px"],["class","well","style","width: 70%; padding: 5px; margin:0 auto; background-color: #e9ddb9;",4,"ngFor","ngForOf"],[1,"col-sm-4",2,"padding-top","6rem"],[1,"btn","btn-outline-info",3,"click"],[1,"well",2,"width","70%","padding","5px","margin","0 auto","background-color","#e9ddb9"],[1,"card",2,"padding","5px","margin","5px"]],template:function(e,o){1&e&&t.YNc(0,tt,22,6,"div",0),2&e&&t.Q6J("ngIf",o.user&&o.user.name)},directives:[h.O5,h.sg],styles:[""]}),i})(),y=(()=>{class i{constructor(e,o){this.authService=e,this.router=o}canActivate(e,o){var n,r;return console.log(this.authService.getUser()&&1==(null===(n=this.authService.getUser())||void 0===n?void 0:n.level)),!(!this.authService.isAuthenticated()||1!=(null===(r=this.authService.getUser())||void 0===r?void 0:r.level))||(this.router.navigate(["/"]),!1)}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(u.e),t.LFG(c.F0))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac}),i})(),A=(()=>{class i{constructor(e,o){this.authService=e,this.router=o}canActivate(e,o){var n,r;return console.log(this.authService.getUser()&&2==(null===(n=this.authService.getUser())||void 0===n?void 0:n.level)),!(!this.authService.isAuthenticated()||2!=(null===(r=this.authService.getUser())||void 0===r?void 0:r.level))||(this.router.navigate(["/"]),!1)}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(u.e),t.LFG(c.F0))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac}),i})();function it(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"tr",10),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(3).showDetail(r)}),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA()()}if(2&i){const e=s.$implicit;t.xp6(2),t.Oqu(e._id),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.email)}}function ot(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",18),t.NdJ("click",function(){return t.CHM(e),t.oxw(4).confirmUser()}),t._uU(1,"Select"),t.qZA()}}function nt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){return t.CHM(e),t.oxw(4).onCancelUser()}),t._uU(1,"Cancel"),t.qZA()}}function st(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"tr",22),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(6).showReturnDetail(r)}),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA()()}if(2&i){const e=s.$implicit,o=t.oxw(6);t.Q6J("ngClass",o.highlight==e._id?"bg-warning":""),t.xp6(2),t.Oqu(o.bookIdToTitle(e.bookId)),t.xp6(2),t.Oqu(e.timeStamp),t.xp6(2),t.Oqu(e.returnDate)}}function rt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"h5"),t._uU(2),t.qZA(),t.TgZ(3,"div",23)(4,"button",24),t.NdJ("click",function(){return t.CHM(e),t.oxw(6).extendLoan()}),t._uU(5,"Extend loan"),t.qZA(),t.TgZ(6,"button",25),t.NdJ("click",function(){return t.CHM(e),t.oxw(6).deleteBorrowed()}),t._uU(7,"Return book"),t.qZA()()()}if(2&i){const e=t.oxw(6);t.xp6(2),t.hij("Total late fee: ",e.calculateLateFee(e.posudbeKorisnika),"\u20ac"),t.xp6(2),t.Q6J("disabled",e.canExtendLoan)}}function ct(i,s){if(1&i&&(t.TgZ(0,"div")(1,"table",6)(2,"thead")(3,"tr")(4,"th",7),t._uU(5,"Book title"),t.qZA(),t.TgZ(6,"th",7),t._uU(7,"Timestamp"),t.qZA(),t.TgZ(8,"th",7),t._uU(9,"Return by"),t.qZA()()(),t.TgZ(10,"tbody"),t.YNc(11,st,7,4,"tr",21),t.qZA()(),t.YNc(12,rt,8,2,"div",0),t.qZA()),2&i){const e=t.oxw(5);t.xp6(11),t.Q6J("ngForOf",e.posudbeKorisnika),t.xp6(1),t.Q6J("ngIf",e.selectedReturn.userId)}}function lt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"h5"),t._uU(2,"Loans:"),t.qZA(),t.YNc(3,ct,13,2,"div",0),t.TgZ(4,"button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw(4).onCancel()}),t._uU(5,"Cancel"),t.qZA()()}if(2&i){const e=t.oxw(4);t.xp6(3),t.Q6J("ngIf",e.posudbeKorisnika)}}function at(i,s){if(1&i&&(t.TgZ(0,"div",11)(1,"div",12)(2,"h5"),t._uU(3),t.qZA(),t.TgZ(4,"h5",13),t._uU(5),t.qZA(),t.TgZ(6,"h5",14),t._uU(7),t.qZA(),t.TgZ(8,"h5",15),t._uU(9),t.qZA(),t.TgZ(10,"h5",15),t._uU(11),t.qZA(),t.YNc(12,ot,2,0,"button",16),t.YNc(13,nt,2,0,"button",17),t.YNc(14,lt,6,1,"div",0),t.qZA()()),2&i){const e=t.oxw(3);t.xp6(3),t.hij('"',e.selectedUser.name,'"'),t.xp6(2),t.Oqu(e.selectedUser.name),t.xp6(2),t.hij("Id: ",e.selectedUser._id,""),t.xp6(2),t.hij("E-mail: ",e.selectedUser.email,""),t.xp6(2),t.hij("Address: ",e.selectedUser.address,""),t.xp6(1),t.Q6J("ngIf",!e.cancelUser),t.xp6(1),t.Q6J("ngIf",e.cancelUser),t.xp6(1),t.Q6J("ngIf",e.showPosudbeKorisnika)}}function ut(i,s){if(1&i&&(t.TgZ(0,"div")(1,"table",6)(2,"thead")(3,"tr")(4,"th",7),t._uU(5,"Id"),t.qZA(),t.TgZ(6,"th",7),t._uU(7,"Name"),t.qZA(),t.TgZ(8,"th",7),t._uU(9,"E-mail"),t.qZA()()(),t.TgZ(10,"tbody"),t.YNc(11,it,7,3,"tr",8),t.ALo(12,"nameFilter"),t.qZA()(),t.YNc(13,at,15,8,"div",9),t._UZ(14,"div"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(11),t.Q6J("ngForOf",t.xi3(12,2,e.korisnici,e.query)),t.xp6(2),t.Q6J("ngIf",e.selectedUser.name)}}function dt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"div",1)(2,"h1",2),t._uU(3,"Manage returns"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return t.CHM(e),t.oxw().backToDashboard()}),t._uU(5,"Back"),t.qZA()(),t.TgZ(6,"div")(7,"h4"),t._uU(8,"Select user"),t.qZA()(),t.TgZ(9,"div",1)(10,"div",4)(11,"p"),t._uU(12,"Search by name:"),t.qZA(),t.TgZ(13,"input",5),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw().query=n}),t.qZA()()(),t.YNc(14,ut,15,5,"div",0),t.qZA()}if(2&i){const e=t.oxw();t.xp6(13),t.Q6J("ngModel",e.query),t.xp6(1),t.Q6J("ngIf",e.korisnici)}}const ht=[{path:"",component:$},{path:"profile",component:et,canActivate:[y]},{path:"admin",loadChildren:()=>l.e(339).then(l.bind(l,3339)).then(i=>i.AdminModule),canActivate:[A]},{path:"returns",component:(()=>{class i{constructor(e,o,n,r,d,b,g,w){this.http=e,this.borrowedService=o,this.userService=n,this.dataService=r,this.auth=d,this.route=b,this.router=g,this.booksService=w,this.cancelEvent=new t.vpe,this.user=null,this.korisnici=[],this.korisnikSubject=null,this.subscription5=null,this.posudbe=[],this.borrowedSubject=null,this.subscription6=null,this.knjige=[],this.bookSubject=null,this.subscription=null,this.posudbeKorisnika=[],this.posudbeKorisnikaSubject=null,this.subscription7=null,this.query="",this.selectedUser=new Z.n,this.selectedReturn=new m,this.canExtendLoan=!1,this.cancelUser=!1,this.showPosudbeKorisnika=!1,this.highlight="",this.showSelectedPosudba=!1}ngOnInit(){this.user=this.auth.getUser(),this.korisnikSubject=this.userService.getUsers(),this.subscription5=this.korisnikSubject.subscribe(e=>{console.log(e),this.korisnici=e},e=>{console.log(e)}),this.borrowedSubject=this.borrowedService.getBorrowed(),this.subscription6=this.borrowedSubject.subscribe(e=>{console.log(e),this.posudbe=e},e=>{console.log(e)}),this.bookSubject=this.booksService.getBooks(),this.subscription=this.bookSubject.subscribe(e=>{console.log(e),this.knjige=e},e=>{console.log(e)})}showDetail(e){this.selectedUser=Object.assign({},e),this.selectedReturn=new m,this.cancelUser=!1,this.showPosudbeKorisnika=!1,this.highlight=""}calculateLateFee(e){let o=0,n=new Date;for(let r=0;r<e.length;r++){let d=new Date(e[r].returnDate);if(d<n){let b=n.getTime()-d.getTime();o+=.1*Math.ceil(b/864e5)}}return o.toPrecision(2)}boolLateFee(e){return parseFloat(this.calculateLateFee(e))>parseFloat("0")}calculateReturnDate(e,o){let n=new Date(e),r=new Date(o),d=r.getTime()-n.getTime(),b=Math.ceil(d/864e5),g=new Date(r.setMonth(r.getMonth()+1)),w=new Date;return b>56&&g>w}confirmUser(){this.posudbeKorisnikaSubject=this.borrowedService.getBorrowed(),this.subscription7=this.posudbeKorisnikaSubject.subscribe(e=>{console.log(e),this.posudbeKorisnika=e.filter(o=>o.userId==this.selectedUser._id)},e=>{console.log(e)}),this.showPosudbeKorisnika=!0,this.cancelUser=!0}bookIdToTitle(e){return this.knjige.filter(n=>n._id==e).map(n=>n.title)}showReturnDetail(e){this.selectedReturn=Object.assign({},e),this.canExtendLoan=!(!this.boolLateFee(this.posudbeKorisnika)&&!this.calculateReturnDate(this.selectedReturn.timeStamp,this.selectedReturn.returnDate)),this.highlight=this.selectedReturn._id}extendLoan(){let e=new Date(this.selectedReturn.returnDate);this.selectedReturn.returnDate=new Date(e.setMonth(e.getMonth()+1)).toLocaleString(),this.borrowedService.editBorrowed(this.selectedReturn),this.selectedReturn=new m,this.highlight=""}deleteBorrowed(){this.borrowedService.deleteBorrowed(this.selectedReturn._id),this.selectedReturn=new m,this.highlight="",this.cancelEvent.emit()}onCancelUser(){this.query="",this.selectedUser=new Z.n,this.highlight="",this.cancelEvent.emit()}onCancel(){this.selectedReturn=new m,this.showPosudbeKorisnika=!1,this.cancelUser=!1,this.highlight="",this.cancelEvent.emit()}backToDashboard(){this.router.navigate([""])}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(p.eN),t.Y36(U),t.Y36(D.f),t.Y36(f.D),t.Y36(u.e),t.Y36(c.gz),t.Y36(c.F0),t.Y36(S.y))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-returns"]],outputs:{cancelEvent:"cancelEvent"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"d-flex","justify-content-around","align-items-center"],[2,"padding","0.375rem"],[1,"btn","btn-secondary",3,"click"],[2,"width","45%"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],[1,"table","table-striped"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],["class","container d-flex justify-content-center","style","padding: 10px;",4,"ngIf"],[3,"click"],[1,"container","d-flex","justify-content-center",2,"padding","10px"],[1,"card",2,"padding","10px","margin","0px auto","width","70%"],[1,"card-title"],[1,"card-subtitle","text-muted"],[1,"card-text"],["class","btn btn-outline-warning",3,"click",4,"ngIf"],["class","btn btn-outline-danger",3,"click",4,"ngIf"],[1,"btn","btn-outline-warning",3,"click"],[1,"btn","btn-outline-danger",3,"click"],[1,"btn","btn-outline-danger","btn-lg",3,"click"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"],[1,"container","d-flex","justify-content-around","align-items-center"],[1,"btn","btn-outline-warning","btn-lg",3,"disabled","click"],[1,"btn","btn-success","btn-lg",3,"click"]],template:function(e,o){1&e&&t.YNc(0,dt,15,2,"div",0),2&e&&t.Q6J("ngIf",o.user&&o.user.name)},directives:[h.O5,_.Fj,_.JJ,_.On,h.sg,h.mk],pipes:[j],styles:["tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#86b7fe}"]}),i})(),canActivate:[A]}];let _t=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[c.Bz.forChild(ht)],c.Bz]}),i})(),pt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({providers:[y,A,{provide:p.TP,useClass:T,multi:!0}],imports:[[h.ez,_.u5,_.UX,_t]]}),i})()},5935:(C,v,l)=>{l.d(v,{f:()=>h});class h{constructor(){this._id="",this.title="",this.authorId="",this.edition=0,this.publisherId="",this.genreId=""}}},639:(C,v,l)=>{l.d(v,{y:()=>t});var h=l(1135),_=l(7579),p=l(1223),x=l(520),k=l(2468);let t=(()=>{class u{constructor(c,a){this.http=c,this.dataService=a,this.books=[],this.bookSubject=new h.X([]),this.responseEmitter=new _.x,this.init()}init(){this.dataService.getBooks().subscribe(c=>{this.books=c,this.bookSubject.next([...this.books])})}getBooks(){return this.bookSubject}addBook(c){this.dataService.addBook(c).subscribe(a=>{console.log(a),this.responseEmitter.next(a.message.toString()),c._id=a.insertedId.toString(),this.books.push(c),this.bookSubject.next(this.books)})}deleteBook(c){this.dataService.deleteBook(c).subscribe(a=>{console.log(a),this.books=this.books.filter(f=>f._id!=c),this.bookSubject.next(this.books)})}editBook(c){this.dataService.editBook(c).subscribe(a=>{console.log(a),this.books[this.books.findIndex(f=>f._id==c._id)]=c,this.bookSubject.next(this.books)},a=>{console.log(a)})}}return u.\u0275fac=function(c){return new(c||u)(p.LFG(x.eN),p.LFG(k.D))},u.\u0275prov=p.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},4917:(C,v,l)=>{l.d(v,{c:()=>t});var h=l(1135),_=l(7579),p=l(1223),x=l(520),k=l(2468);let t=(()=>{class u{constructor(c,a){this.http=c,this.dataService=a,this.publishers=[],this.publisherSubject=new h.X([]),this.genres=[],this.genreSubject=new h.X([]),this.responseEmitter=new _.x,this.init()}init(){this.dataService.getPublishers().subscribe(c=>{this.publishers=c,this.publisherSubject.next([...this.publishers])}),this.dataService.getGenres().subscribe(c=>{this.genres=c,this.genreSubject.next([...this.genres])})}getPublishers(){return this.publisherSubject}addPublisher(c){this.dataService.addPublisher(c).subscribe(a=>{console.log(a),this.responseEmitter.next(a.message.toString()),c._id=a.insertedId.toString(),this.publishers.push(c),this.publisherSubject.next(this.publishers)})}getGenres(){return this.genreSubject}addGenre(c){this.dataService.addGenre(c).subscribe(a=>{console.log(a),this.responseEmitter.next(a.message.toString()),c._id=a.insertedId.toString(),this.genres.push(c),this.genreSubject.next(this.genres)})}}return u.\u0275fac=function(c){return new(c||u)(p.LFG(x.eN),p.LFG(k.D))},u.\u0275prov=p.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()}}]);